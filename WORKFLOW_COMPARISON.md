# 开发工作流对比

## 改进前 vs 改进后

### 旧工作流（改进前）⏳

```
┌─────────────────────────────────────────────────────┐
│ 开发者工作流程                                        │
└─────────────────────────────────────────────────────┘

1️⃣  编写代码
     ↓
2️⃣  运行 yarn build (需要等待 30-60 秒)
     ↓
3️⃣  运行 yarn unpkg
     ↓
4️⃣  在华炎魔方中测试
     ↓
5️⃣  发现问题？
     ↓
6️⃣  停止 unpkg 服务器 (Ctrl+C)
     ↓
7️⃣  修改代码
     ↓
8️⃣  重新运行 yarn build (又要等 30-60 秒) 😫
     ↓
9️⃣  重新运行 yarn unpkg
     ↓
🔟 重新测试
     ↓
     回到步骤 5 (循环往复...)

═══════════════════════════════════════════════════════
总结：每次修改需要 5 个步骤 + 等待时间
问题：重复劳动多，效率低，开发体验差
```

---

### 新工作流（改进后）⚡

```
┌─────────────────────────────────────────────────────┐
│ 开发者工作流程                                        │
└─────────────────────────────────────────────────────┘

0️⃣  一次性启动：yarn dev
     ↓
     ┌─────────────────────────────────┐
     │  后台自动运行：                   │
     │  • Unpkg 服务器 (端口 8080)      │
     │  • Watch 模式（监听所有包）        │
     └─────────────────────────────────┘
     ↓
1️⃣  编写代码
     ↓
2️⃣  保存文件 ✨ (自动触发编译，无需等待)
     ↓
3️⃣  刷新浏览器测试
     ↓
4️⃣  发现问题？直接修改代码
     ↓
     回到步骤 2 (快速迭代！)

═══════════════════════════════════════════════════════
总结：每次修改只需 2 个步骤 + 自动编译
优势：自动化程度高，开发效率高，体验好
```

---

## 对比总结

| 指标 | 改进前 | 改进后 | 提升 |
|------|--------|--------|------|
| **启动命令** | 2 个 (`yarn build` + `yarn unpkg`) | 1 个 (`yarn dev`) | 50% ⬇️ |
| **每次修改步骤** | 5 步 | 2 步 | 60% ⬇️ |
| **每次修改等待时间** | 30-60 秒 | ~5 秒（自动） | 90% ⬇️ |
| **需要手动编译？** | ✅ 是 | ❌ 否 | ✨ 自动化 |
| **支持热重载？** | ❌ 否 | ✅ 是 | ✨ 新增 |
| **开发体验** | 😫 繁琐 | 😊 流畅 | 🚀 极大提升 |

---

## 实际使用示例

### 场景：修改一个组件的样式

#### 改进前（旧方式）

```bash
# 初次启动
$ yarn build          # 等待 60 秒
$ yarn unpkg          # 启动服务器

# 第 1 次修改
修改 src/components/Hello.tsx
Ctrl+C                # 停止服务器
$ yarn build          # 再等 60 秒 😫
$ yarn unpkg          
刷新浏览器测试

# 第 2 次修改（发现颜色不对）
修改 src/components/Hello.tsx
Ctrl+C
$ yarn build          # 又等 60 秒 😫😫
$ yarn unpkg
刷新浏览器测试

# 第 3 次修改（发现间距不对）
修改 src/components/Hello.tsx
Ctrl+C
$ yarn build          # 继续等 60 秒 😫😫😫
$ yarn unpkg
刷新浏览器测试

总时间：3 * (60秒编译 + 10秒操作) = 210 秒 = 3.5 分钟
```

#### 改进后（新方式）

```bash
# 初次启动（只需一次）
$ yarn dev            # 一次启动，全程运行 ✨

# 第 1 次修改
修改 src/components/Hello.tsx
保存文件（自动编译，~5秒）✨
刷新浏览器测试

# 第 2 次修改（发现颜色不对）
修改 src/components/Hello.tsx
保存文件（自动编译，~5秒）✨
刷新浏览器测试

# 第 3 次修改（发现间距不对）
修改 src/components/Hello.tsx
保存文件（自动编译，~5秒）✨
刷新浏览器测试

总时间：3 * (5秒自动编译 + 5秒操作) = 30 秒
```

**时间节省：210 秒 → 30 秒 = 节省 85% 的时间！** 🎉

---

## 技术实现

### 架构设计

```
┌─────────────────────────────────────────────────────────┐
│                     yarn dev                            │
│                  (dev-server.js)                        │
└──────────────┬──────────────────────┬───────────────────┘
               │                      │
               ↓                      ↓
   ┌───────────────────┐    ┌─────────────────────┐
   │   Unpkg Server    │    │   Watch Process     │
   │   (Express)       │    │   (Lerna + Rollup)  │
   │                   │    │                     │
   │ • 提供静态资源     │    │ • 监听源文件变化    │
   │ • CORS 支持       │    │ • 自动触发编译      │
   │ • 端口 8080       │    │ • 并行处理多包      │
   └───────────────────┘    └─────────────────────┘
               │                      │
               ↓                      ↓
   ┌───────────────────────────────────────────┐
   │        华炎魔方项目                        │
   │  (通过 STEEDOS_PUBLIC_PAGE_ASSETURLS)    │
   │      http://127.0.0.1:8080/...          │
   └───────────────────────────────────────────┘
```

### 关键组件

1. **dev-server.js**
   - 集成了 unpkg 服务器和 watch 模式
   - 一个命令启动所有服务
   - 优雅的错误处理和日志输出

2. **Watch Scripts**
   - 每个包都配置了 `watch` 脚本
   - 使用 `rollup -c -w` 监听文件变化
   - 支持 TypeScript、CSS、JSON 等多种文件类型

3. **Lerna 集成**
   - `lerna run watch --parallel` 并行监听所有包
   - 支持增量编译
   - 自动处理包间依赖

---

## 总结

✨ **改进后的开发工作流带来的好处：**

1. **提高效率** - 减少 85% 的等待时间
2. **降低认知负担** - 不需要记住多个命令
3. **改善开发体验** - 即改即看，快速迭代
4. **减少错误** - 自动化减少人为操作失误
5. **便于新手上手** - 一个命令搞定一切

🚀 **立即开始使用：**

```bash
yarn dev
```

就这么简单！
